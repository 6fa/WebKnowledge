# æœŸçº¦ä¸å¼‚æ­¥å‡½æ•°

## æœŸçº¦(Promise)

### 1.æœŸçº¦çŠ¶æ€ï¼š
æœŸçº¦æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„å¯¹è±¡
  - å¾…å®špending
  - å…‘ç°fulfilledæˆ–è€… è§£å†³resolved
  - æ‹’ç»rejected

æ¯”å¦‚æ‰“å°ä¸€ä¸ªæœŸçº¦ï¼š
```javascript
let p = new Promise((resolve,reject)=>{
  resolve(3)
})
console.log(p) //Promise {<fulfilled>: 3}
```

### 2.å®ä¾‹åŒ–æœŸçº¦
  - new Promise()
  - Promise.resolve() å®ä¾‹åŒ–ä¸€ä¸ªè§£å†³æœŸçº¦
  - Promise.reject() å®ä¾‹åŒ–ä¸€ä¸ªæ‹’ç»æœŸçº¦

### 3.æœŸçº¦çš„å®ä¾‹æ–¹æ³•ï¼šthen
  -  æ³¨æ„å’Œnew PromiseåšåŒºåˆ«ï¼Œnew Promiseæ¥æ”¶ä¸€ä¸ªæ‰§è¡Œå™¨å‡½æ•°ï¼Œthenæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼šonResolvedå¤„ç†ç¨‹åºã€onRejectedå¤„ç†ç¨‹åºï¼Œå¦‚æœç¬¬ä¸€ä¸ªä¸ä¼ åˆ™å¡«nullï¼Œé¿å…åœ¨å†…å­˜ä¸­åˆ›å»ºå¤šä½™å¯¹è±¡ã€‚
  - thenè¿”å›ä¸€ä¸ªæ–°æœŸçº¦å®ä¾‹
  - thenä¸¤ä¸ªå¤„ç†ç¨‹åºéƒ½ä¸ä¼ ï¼Œåˆ™åŸæ ·å‘åä¼ 
  - thenæ²¡æœ‰æ˜æ˜¾è¿”å›å€¼æ—¶ï¼Œé»˜è®¤è¿”å›Promise.resolveåŒ…è£…è¿‡çš„undefined

```javascript
let p = new Promise((resolve,reject)=>{
  resolve(3)
}).then((res)=>{
  console.log(res) //3
}).then((res)=>{
  console.log(res) //undefined,æ²¡æœ‰æ˜æ˜¾è¿”å›å€¼æ—¶ï¼Œé»˜è®¤è¿”å›Promise.resolveåŒ…è£…è¿‡çš„undefined
})
```

### 4.æœŸçº¦çš„å®ä¾‹æ–¹æ³•ï¼šcatch
ç›¸å½“äºè°ƒç”¨Promise.prototype.then(null, onRejected)

### 5.æœŸçº¦çš„å®ä¾‹æ–¹æ³•ï¼šfinally
  -  æ¥æ”¶ä¸€ä¸ªonFinallyå¤„ç†ç¨‹åº
  - æœŸçº¦ä¸ºæ‹’ç»æˆ–è§£å†³éƒ½ä¼šè°ƒç”¨finallyï¼Œä¸»è¦ç”¨æ¥æ·»åŠ æ¸…ç†ä»£ç 
  - å¦‚æœfinallyåé¢è¿˜æœ‰è¿ç¼€æˆ–è€…å…¶ä»–æ“ä½œï¼š
    - å¤šæ•°æƒ…å†µåŸæ ·å¾€åä¼  çˆ¶æœŸçº¦ 
    - å¦‚æœfinallyè‡ªå·±è¿”å›ä¸€ä¸ªå¾…å®šæœŸçº¦ã€æ‹’ç»æœŸçº¦ã€æŠ›å‡ºé”™è¯¯ï¼Œåˆ™è¿”å›ç›¸åº”çš„æœŸçº¦ï¼ˆå¾…å®šæˆ–æ‹’ç»ï¼‰

### 6.thenã€catchã€finallyæ˜¯å¾®ä»»åŠ¡
æœŸçº¦è½å®šçŠ¶æ€åï¼Œå…¶å¤„ç†ç¨‹åºï¼ˆthenã€catchç­‰ï¼‰ä¼šè¢«æ’æœŸï¼Œè€Œä¸æ˜¯ç«‹å³æ‰§è¡Œã€‚
å¾®ä»»åŠ¡ã€å®ä»»åŠ¡å’ŒJSçš„äº‹ä»¶å¾ªç¯æœºåˆ¶æœ‰å…³ï¼Œå¯å‚è€ƒæœ¬äººçš„å¦ä¸€ç¯‡æ–‡ç« ï¼š[JSæ‰§è¡Œæœºåˆ¶](../JSåŸºç¡€/JSæ‰§è¡Œæœºåˆ¶.md)

### 7.æŠ›å‡ºé”™è¯¯æˆ–è€…æ‹’ç»æœŸçº¦ï¼Œæ²¡æœ‰å¤„ç†çš„è¯ï¼Œéƒ½ä¼šæŠ›å‡ºæœªæ•è·é”™è¯¯
```javascript
let p = Promise.reject("xx")

Uncaught (in promise) xx
```
è€Œä¸”é”™è¯¯æ˜¯å¼‚æ­¥æŠ›å‡ºçš„ï¼Œä¸ä¼šé˜»æ­¢è¿è¡Œæ—¶ç»§ç»­æ‰§è¡ŒåŒæ­¥å‘½ä»¤ã€‚

å› æ­¤ä¸èƒ½ç”¨try catchè¿™ç§åŒæ­¥ç»“æ„æ•è·é”™è¯¯ï¼Œè€Œè¦é€šè¿‡å¼‚æ­¥çš„å¤„ç†ç¨‹åºæ•è·(thenã€catchã€finally)

æ³¨æ„è¿™ä¸ªä¾‹å­ï¼š
```javascript
let p1 = Promise.reject("1")
let p2 = Promise.resolve().then(()=>{throw Error("2:æ‹’ç»")})
let p3 = Promise.resolve().then(()=>{console.log("3:è§£å†³")})
let p4 = Promise.reject(Error("4"))

//å‡ºç°é¡ºåº
	3:è§£å†³
	Uncaught (in promise) 1
	Uncaught (in promise) Error: 4	
	Uncaught (in promise) Error: 2:æ‹’ç»
```

ğŸ™„å¯ä»¥çœ‹åˆ°Promise.resolve().thençš„é”™è¯¯æœ€åæ‰å‡ºç°ï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨è¿è¡Œæ—¶æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ å¤„ç†ç¨‹åº

ğŸ™„å¹¶ä¸”ï¼Œå½“å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåï¼Œæ‰ä¼šå¤„ç†é”™è¯¯ 

### 8.Promise.allã€Promise.raceçš„æ³¨æ„ç‚¹
  - å®ƒä»¬æ¥æ”¶çš„æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œé‡Œé¢çš„å…ƒç´ ä¼šé€šè¿‡Pomise.resolveè½¬æ¢æˆæœŸçº¦
  - allæœ‰ä¸€ä¸ªä¸ºæ‹’ç»æœŸçº¦ï¼Œåé¢çš„æœŸçº¦è¿˜æ˜¯ä¼šè¢«é™é»˜å¤„ç†ï¼ˆå³è¿˜æ˜¯æœ‰æ‰§è¡Œï¼‰
  - raceåŒç†


## å¼‚æ­¥å‡½æ•°Async await
å¼‚æ­¥å‡½æ•°æ˜¯æœŸçº¦æ¨¡å¼åœ¨å‡½æ•°ä¸­çš„åº”ç”¨ï¼Œä½¿å¾—å¯ä»¥ä»¥åŒæ­¥çš„ä¹¦å†™æ–¹å¼æ¥å†™å¼‚æ­¥ä»£ç ã€‚

### 1.asyncå…³é”®å­—
  - asyncå…³é”®å­—è®©å‡½æ•°å…·æœ‰å¼‚æ­¥ç‰¹å¾ï¼Œä½†æ˜¯å…¶ä»£ç ä»ç„¶æ˜¯åŒæ­¥æ±‚å€¼çš„ã€‚

  - å¦‚æœasyncå‡½æ•°ç”¨ä½¿ç”¨returnè¿”å›äº†å€¼ï¼Œåˆ™è¿”å›å€¼ä¼šè¢«Promise.resolveåŒ…è£…æˆä¸€ä¸ªæœŸçº¦å¯¹è±¡ï¼›å¦‚æœæ²¡æœ‰returnï¼Œåˆ™è¿”å›undefined

  - asyncå‡½æ•°é‡Œé¢çš„æ‹’ç»æœŸçº¦ä¸ä¼šè¢«æ•è·

```javascript
async function foo(){
  Promise.reject("err")
}
foo().catch(console.log)

//Uncaught (in promise) err
```

### 2.awaitå…³é”®å­—
  - awaitå¯ä»¥æš‚åœå¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œ
  - awaitåé¢å¦‚æœè·Ÿä¸€ä¸ªæ‹’ç»æœŸçº¦ï¼Œé‚£ä¹ˆä¼šè¢«catchæ•è·ï¼ˆå’Œasyncç›¸åï¼‰
  ```javascript
  async function foo(){
    await Promise.reject("err")
  }
  foo().catch(console.log)
  // err
  ```

  - jsé‡åˆ°awaitæ—¶ï¼Œä¼šè®°å½•åœ¨å“ªé‡Œæš‚åœæ‰§è¡Œï¼Œç­‰awaitå³è¾¹çš„å€¼å¯ç”¨äº†ï¼Œjsè¿è¡Œæ—¶ä¼šå‘æ¶ˆæ¯é˜Ÿåˆ—æ¨é€ä¸€ä¸ªä»»åŠ¡ï¼Œä»¥æ¢å¤å¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œ
  - å³ä½¿awaitå³è¾¹æ˜¯ç«‹å³å¯ç”¨çš„å€¼ï¼Œå‡½æ•°çš„å…¶ä½™éƒ¨åˆ†ä¹Ÿä¼šå¼‚æ­¥æ±‚å€¼
  - å¦‚æœawaitå³è¾¹æ˜¯ä¸€ä¸ªæœŸçº¦ï¼Œä¸ºäº†æ‰§è¡Œå¼‚æ­¥å‡½æ•°ï¼Œå®é™…ä¸Šä¼šæœ‰2ä¸ªä»»åŠ¡è¢«æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶è¢«å¼‚æ­¥æ±‚å€¼ã€‚ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯ æœŸçº¦åœ¨è½å®šä¹‹åæ‰§è¡Œï¼ŒæœŸçº¦ç«‹å³è½å®šï¼Œå†æ·»åŠ  ç»™awaitæä¾›å€¼ çš„ä»»åŠ¡ã€‚

å¯ä»¥æ¯”è¾ƒä¸‹é¢çš„ä¾‹å­ï¼š
```javascript
async function test(){
  return 8
}

async function foo(){
  console.log(2)
  console.log(await test())
  console.log(9)
}
async function bar(){
  console.log(4)
  console.log(await 6)
  console.log(7)
}
console.log(1)
foo()
console.log(3)
bar()
console.log(5)

//æ‰“å°é¡ºåºï¼š1 2 3 4 5 8 9 6 7
```

```javascript
async function foo(){
  console.log(2)
  console.log(await new Promise((resolve,reject)=>{
    console.log('xx')
    resolve(8)
  }))
  console.log(9)
}
async function bar(){
  console.log(4)
  console.log(await 6)
  console.log(7)
}
console.log(1)
foo()
console.log(3)
bar()
console.log(5)

//æ‰“å°é¡ºåºï¼š1 2 xx 3 4 5 8 9 6 7
```

```javascript

async function foo(){
  console.log(2)
  
  console.log(await new Promise((resolve,reject)=>{
    console.log('xx')
    resolve()
  }).then(()=>{
    console.log("yy")
  }).then(()=>{
    console.log("zz")
    return 8
  }))
  
  console.log(9)
}
async function bar(){
  console.log(4)
  console.log(await 6)
  console.log(7)
}
console.log(1)
foo()
console.log(3)
bar()
console.log(5)

// 1 2 xx 3 4 5 yy 6 7 zz 8 9
```

æ³¨æ„ï¼šæ˜¯ç­‰åˆ°awaitå³è¾¹çš„å€¼å¯ä»¥ç”¨äº†ï¼Œjsè¿è¡Œæ—¶ä¼šå‘æ¶ˆæ¯é˜Ÿåˆ—æ¨é€ä¸€ä¸ª æ¢å¤å¼‚æ­¥å‡½æ•°æ‰§è¡Œ çš„ä»»åŠ¡ã€‚è¿™ä¸ªä»»åŠ¡ä¼šåœ¨åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åè¢«æå–ã€‚