## 前言
文章内容基本上为《图解HTTP》这本书的知识点总结，一些相关知识点解释会引用其他书/博主写的内容。

学习HTTP的起因是一道很常见的题目：输入一个url地址到显示页面，中间发生了什么。这就涉及到了互联网通信协议TCP/IP协议族，其中HTTP协议为其中一个子集。《图解HTTP》从TCP/IP协议讲起，前半部分比较全面地介绍了通信传输流如何传输、相关协议及相应负责的功能，后半部分详细介绍HTTP协议。

如有错误的地方，欢迎指正~

## TCP/IP协议族是什么
两台计算机想要相互通信，就要基于相同的规则（如何探测到通信目标、使用哪种语言通信、web页面显示的步骤处理、怎样结束通信等），我们把这种规则称为 协议 （protocol），把互联网相关的协议的集合称为TCP/IP协议族。

## 分层概念
我们将TCP/IP协议族分为 应用层、传输层、网络层、链路层。
为什么要分层呢？
1. 更改方便：如果互联网只有一个协议统筹，某个地方需要更改设计时就要整体替换。分层后，把各个层之间的接口规划好，每个层的内部能够自由改动。
2. 设计更简单：每个层可以只考虑自己的部分。

### 应用层
决定了向用户提供应用服务时通信的活动（即向用户提供应用程序，比如电子邮件/文件传输访问等）。FTP（文件传输协议）、HTTP、DNS（域名系统）、URI（统一资源标志符）、SSH（安全外壳协议）等都属于该层的协议。
### 传输层
对应用层，提供处于网络连接中的两台计算机之间的数据传输（提供应用程序间的通信）：格式化信息流、提供可靠传输。
传输层有两个性质不同的协议：TCP（传输控制协议）、UDP（用户数据报协议）。
### 网络层
处理在网络上流动的数据包（数据被分割成更小的包，即网络传输的最小数据单位），规定了传输路线，并把数据包传送给对方。
网络层协议有IP、RIP、ICMP等
### 链路层
其实可以分为数据链路层和物理层。
数据链路层负责封装和解封装IP报文，发送和接受ARP（地址解析协议）/RARP（逆地址解析协议）报文等。
物理层以二进制数据形式在物理媒体上传输数据。


## 通信传输流
既然知道了TCP/IP协议的分层，就要来看看数据如何在这些层之间传输。

网络通信时，会通过分层顺序与对方进行通信。发送端从应用层往下走，接收端从链路层往上走。
以HTTP协议为例子：
1. 客户端在应用层（HTTP协议）发出HTTP请求（此时有用到URI，以及域名系统DNS协议解析域名，得到主机的ip），（将 想要访问的服务器页面资源 结合自己的本机信息）生成HTTP请求报文
2. 传输层（TCP协议）接受到HTTP请求报文，将数据进行分割，并且打上标记序号和端口号等信息（TCP首部），转发给网络层
3. 网络层（IP协议）增加作为通信目的的MAC地址，生成带有IP首部的数据包（网络层主要负责物理地址（MAC）和逻辑地址（IP）的转换），转发给链路层。
ps：MAC地址是物理地址，指网卡所属的固定地址；IP地址是逻辑地址，是节点被分配到的地址
4. 接受端的服务器 在 链路层接收到数据，（把数据封装成帧），按顺序往上层发送，每过一层删除首部。

## IP协议（负责传输）
IP协议（网际协议）位于网络层，几乎所有使用网络的系统都会用到IP协议。作用是把各种数据包传送给对方。要保证确实传送到位，需要满足各种条件，比如MAC地址和IP地址。

IP协议提供的是不可靠（并不保证所要传输的数据一定会到达目的地，数据传输错误时会丢掉此数据并返回一个ICMP信息，因此可靠性依赖上层协议提供，即TCP）、无连接（数据包在传输中没有连接起来，是分开独立处理的。比如需要向某个地方发送两个数据报A、B，他们两个有可能会经由不同的路径去到达目的地，有可能B要比A先到达）的传输服务，将每个包路由至它的目的地。

上面说的的路由（routing）：网络通信时，很少是在同一局域网中，通常需要经过多台计算机和网络设备。中转时，利用MAC地址搜索下一中转目标。这时采用ARP协议，将IP地址查出对应MAC地址。

## TCP协议（确保可靠性）
TCP位于传输层，提供可靠的字节流服务。为了更容易传输大数据，把数据分割成以报文段（segment）为单位的数据包。数据到达接受端的TCP后，会把数据按序号重组。
为了保证可靠性，采用三次握手四次挥手策略。

### 三次握手
1. 发送端发送带有SYN标志的数据包给接收端。
### 四次挥手